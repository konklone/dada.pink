---
title: R graphics magic that you should never use
---
I've been making graphics in R for quite a while

I've spent years of my life trying to make nice plots with base R
graphics. I've learned a bunch of tricks along the way, so now I'm
going to show you everything I can remember.

## Data
I'm going to use data came from an earlier version of
[this website](http://peregrinossantiago.es/eng/post-peregrinacion/estadisticas/).
They're "statistics about pilgrims who have arrived in Santiago".

```r
pilgrams <- sqldf('select * from pilgram', dbname = 'pilgrams-db.sqlite')
```

I'm also going to use data from a
[wellbeing study](https://data.somervillema.gov/dataset/Results-of-2011-Wellbeing-Study/pjhx-dusc)
about Somerville, Massachusetts. There are a lot of missing values in this dataset, and I'm only
trying to show you how to make plots, so I'm just going to remove the missing values.

```r
wellbeing <- na.omit(read.csv('http://data.somervillema.gov/api/views/pjhx-dusc/rows.csv?accessType=DOWNLOAD'))
```

## Barplot
Maybe we want count the marital statuses of Somerville residents.
This won't work.

    barplot(wellbeing$X24..What.is.your.marital.status.)

Instead, you need to give barplot a vector of heights. We can make one with `table`.

```{r barplot-
barplot(table(wellbeing$X24..What.is.your.marital.status.))
```

I can't read the bar labels, so let's make the bars horizontal.

```{r barplot-
barplot(table(wellbeing$X24..What.is.your.marital.status.), horiz = TRUE)
```

Oops. Now the labels are rotated the wrong way. The `las` parameter to `par` handles that.

```{r barplot-
barplot(table(wellbeing$X24..What.is.your.marital.status.), horiz = TRUE, las = 1)
```

And let's adjust the margin and bar labels so the text doesn't fall off.

```{r barplot-
levels(wellbeing$X24..What.is.your.marital.status.)[3] <- "Living with a partner\nbut not married"
par(mar = c(5, 12, 4, 2))
barplot(table(wellbeing$X24..What.is.your.marital.status.), horiz = TRUE, las = 1)
```

I also want to sort the bars so they're easier to read.

```{r barplot-
barplot(sort(table(wellbeing$X24..What.is.your.marital.status.), decreasing = TRUE), horiz = TRUE, las = 1)
```

The black border around the bars is noisy; let's remove it.

```{r barplot-
barplot(
  sort(table(wellbeing$X24..What.is.your.marital.status.), decreasing = TRUE),
  horiz = TRUE, las = 1, border = NA
)
```

Now the colors don't match. We could just make the bars black,

```{r barplot-
barplot(
  sort(table(wellbeing$X24..What.is.your.marital.status.), decreasing = TRUE),
  horiz = TRUE, las = 1, border = NA, col = 1
)
```

but that's a bit harsh. Instead, let's make everything grey.

```{r barplot-
barplot(
  sort(table(wellbeing$X24..What.is.your.marital.status.), decreasing = TRUE),
  horiz = TRUE, las = 1, border = NA, col = '#666666', fg = '#333333', col.axis = '#333333'
)
```

And add a title, of course

```{r barplot-
barplot(
  sort(table(wellbeing$X24..What.is.your.marital.status.), decreasing = TRUE),
  horiz = TRUE, las = 1, border = NA, col = '#666666', fg = '#333333', col.axis = '#333333',
  xlab = 'Number of residents',
  main = 'Marital statuses of Somerville residents'
)
```

The above call is boilerplate to me; in order to have any chance at making
a vaguely decent bar plot, you minimally need to adjust all of those parameters.
Summing that up, this is what I think the default barplot function should be.

```{r barplot-tom}
tom.barplot <- function(height, col = 'grey', border = NA, ...) {
  barplot(
    sort(table(height)), col = col, border = border,
    col = '#666666', fg = '#333333', col.axis = '#333333',
    ...
  )
}
```





    

```r
wellbeing$gender <- factor(wellbeing$X15..Gender..1..female..2..male., levels = c(1:2,NA), exclude = NULL)
levels(wellbeing$gender)[1:2] <- c('Female', 'Male')
table(wellbeing$gender)
```




## `par()$box`

    ‘bty’ A character string which determined the type of ‘box’ which
         is drawn about plots.  If ‘bty’ is one of ‘"o"’ (the
         default), ‘"l"’, ‘"7"’, ‘"c"’, ‘"u"’, or ‘"]"’ the resulting
         box resembles the corresponding upper case letter.  A value
         of ‘"n"’ suppresses the box.

## Conclusion
I hope that you see how much of a mess base R graphics is.
Learn from my mistakes! Don't torture yourself with base R graphics;
**use ggplot**!
